<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Farm ESP32 LoRa PJON base station: Base station for connecting remote sensors to Thingsboard.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Farm ESP32 LoRa PJON base station
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Base station for connecting remote sensors to Thingsboard. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_Readme"></a>Remote sensors use <a href="https://github.com/gioblu/PJON">PJON over LoRa</a> radio to communicate. The <a href="https://thingsboard.io/docs/reference/gateway-mqtt-api/">Thingsboard Gateway MQTT API</a> is used to connect on the Thingsboard side.</p>
<p>See <a href="https://github.com/jgOhYeah/Farm-PJON-LoRa-network">here</a> for other sensors and more information on the system.</p>
<p>Written by Jotham Gates August 2023</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Photos</h1>
<p><img src="Inside.jpg" alt="" class="inline" title="Inside the enclosure."/> <img src="Completed.jpg" alt="" class="inline" title="The completed unit."/></p>
<h1><a class="anchor" id="autotoc_md2"></a>
Getting started</h1>
<p>The Github repository containing all design files and code is <a href="https://github.com/jgOhYeah/FarmBaseStation">here</a>.</p>
<ol type="1">
<li>Install Platform IO.</li>
<li>Open the project in the <a href="./BaseStationCode/"><code>BaseStationCode</code></a> directory.</li>
<li>Create a copy of <a href="./BaseStationCode/credentials.example.ini"><code>BaseStationCode/credentials.example.ini</code></a> and name this <code>credentials.ini</code>. Fill out the settings in this file for the WiFi network to connect to, MQTT broker, Thingsboard credentials and Over The Air (OTA) update settings.</li>
<li>Upload the code to the ESP32.</li>
<li>Assemble the electronics as shown in the schematics and optionally place inside a case.</li>
<li>Test with other sensors and the Thingsboard server.</li>
</ol>
<h1><a class="anchor" id="autotoc_md3"></a>
Updating using OTA updates</h1>
<p>Over the air (OTA) updates can be used to update the software on the base station once it has been programmed for the first time. To do this:</p><ol type="1">
<li>Edit the upload port and auth flags in <code>credentials.ini</code> to match those currently set on the device.</li>
<li>Change the active Platform IO environment to <code>Tardis-OTA</code> from its default <code>Tardis</code> environment (likewise for the <code>TVAnt</code> environemnt for ethernet).</li>
<li>Compile and upload code as normal.</li>
</ol>
<h1><a class="anchor" id="autotoc_md4"></a>
Schematics</h1>
<p>The base station uses an ESP32 development board as its base. An SX1278 LoRa radio module breakout board is connected via jumper leads. LEDs are soldered along with their respective current limiting resistors to wires that can be plugged into the ESP32 board. An audio amplifier and speaker can also be connected for alarm functionality. I salvaged this from the sound effects module of a broken children's ride on toy car.</p>
<p><img src="BaseStationSchematics/Exports/BaseStationSchematics.svg" alt="The schematic for the base station" style="pointer-events: none;" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md5"></a>
Fun part / experiments</h1>
<p>I originally planned to use the build in DAC of the ESP32 to play sounds on alarm conditions. At this point I haven't succeded in this (currently using the <a href="https://github.com/jgOhYeah/TunePlayer">TunePlayer</a> library to play simple monotonic songs instead). I did come across the <a href="https://github.com/pschatzmann/ESP32-A2DP">ESP32-A2DP</a> library that allows the use of this unit as a terrible sounding bluetooth speaker.</p>
<p><a href="Fun/BluetoothSpeaker/BluetoothSpeaker.ino">This sketch</a> is the <code>bt_music_receiver_to_internal_dac</code> example from the ESP32-A2DP library with the addition of flashing lights. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
